name: numbat-tasks

services:
    api:
        build:
            dockerfile: docker/api/development.dockerfile
            context: .
        volumes:
            # Allow live reloading
            - ./api:/api
        env_file:
            - .env
        depends_on:
            database:
                condition: service_started
    database:
        image: postgres:16-bookworm
        volumes:
            - postgres_data:/var/lib/postgresql/data/
        env_file:
            - .env
    frontend:
        build:
            dockerfile: docker/frontend/development.dockerfile
            context: .
        volumes:
            - ./frontend:/frontend
            - /frontend/node_modules/
        environment:
            - PORT=8000
    caddy:
        image: caddy:2-alpine
        ports:
            - "8000:80"
        volumes:
            - ./docker/caddy/Caddyfile:/etc/caddy/Caddyfile:ro
            - caddy_data:/data
            - caddy_config:/config
        depends_on:
            api:
                condition: service_started
            frontend:
                condition: service_started

volumes:
    postgres_data:
    caddy_data:
    caddy_config: